<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ™ºèƒ½å¡«æŠ¥å¹´åº¦æ€»ç»“</title>
    <style>
        /* ==================== åŸºç¡€æ ·å¼ ==================== */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 20px; 
            background-color: #f4f7f6; 
            color: #333; 
            line-height: 1.6;
        }
        
        /* ä¸»å®¹å™¨æ ·å¼ */
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background-color: #fff; 
            padding: 30px; 
            border-radius: 8px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
        }
        
        /* æ ‡é¢˜æ ·å¼ */
        h1 { 
            text-align: center; 
            color: #007bff; 
            margin-bottom: 30px; 
            font-size: 2.2em;
            font-weight: 600;
        }
        
        /* è¯´æ˜æ–‡å­—æ ·å¼ */
        .description {
            background-color: #e7f3ff;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 25px;
            border-left: 4px solid #007bff;
        }
        
        .description p {
            margin: 0;
            color: #0056b3;
        }
        
        /* è¡¨å•æ ‡ç­¾æ ·å¼ */
        label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: bold; 
            color: #555; 
            font-size: 1.1em;
        }
        
        /* æ–‡æœ¬è¾“å…¥æ¡†æ ·å¼ */
        textarea { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid #ccc; 
            border-radius: 5px; 
            box-sizing: border-box; 
            font-size: 16px; 
            margin-bottom: 15px; 
            min-height: 200px; 
            resize: vertical; 
            font-family: inherit;
            transition: border-color 0.3s ease;
        }
        
        textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0,123,255,0.3);
        }
        
        /* æ–‡ä»¶ä¸Šä¼ è¾“å…¥æ¡†æ ·å¼ */
        input[type="file"] { 
            margin-bottom: 15px; 
            border: 1px solid #ccc; 
            padding: 8px; 
            border-radius: 5px; 
            background-color: #f9f9f9; 
            width: 100%; 
            box-sizing: border-box; 
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        input[type="file"]:focus {
            outline: none;
            border-color: #007bff;
        }
        
        /* æäº¤æŒ‰é’®æ ·å¼ */
        button { 
            background-color: #28a745; 
            color: white; 
            padding: 12px 25px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 18px; 
            display: block; 
            width: 100%; 
            transition: background-color 0.3s ease;
            font-weight: 600;
        }
        
        button:hover { 
            background-color: #218838; 
        }
        
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        
        /* ç»“æœåŒºåŸŸæ ·å¼ */
        .result-section { 
            margin-top: 30px; 
            text-align: center; 
        }
        
        /* åŠ è½½æç¤ºæ ·å¼ */
        .loading { 
            display: none; 
            color: #007bff; 
            font-size: 1.1em; 
            padding: 15px;
            background-color: #e7f3ff;
            border-radius: 5px;
            border: 1px solid #b3d9ff;
        }
        
        /* é”™è¯¯ä¿¡æ¯æ ·å¼ */
        .error { 
            color: #dc3545; 
            font-weight: bold; 
            margin-top: 10px; 
            display: none; 
            padding: 15px;
            background-color: #f8d7da;
            border-radius: 5px;
            border: 1px solid #f5c6cb;
        }
        
        /* ä¸‹è½½é“¾æ¥æ ·å¼ */
        .download-link { 
            display: none; 
            margin-top: 20px; 
        }
        
        .download-link a { 
            background-color: #007bff; 
            color: white; 
            padding: 12px 25px; 
            border-radius: 5px; 
            text-decoration: none; 
            font-size: 1.1em; 
            display: inline-block;
            transition: background-color 0.3s ease;
            font-weight: 600;
        }
        
        .download-link a:hover { 
            background-color: #0056b3; 
        }
        
        /* åˆ†éš”çº¿æ ·å¼ */
        .divider {
            text-align: center;
            margin: 20px 0;
            position: relative;
        }
        
        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background-color: #ddd;
        }
        
        .divider span {
            background-color: white;
            padding: 0 15px;
            color: #666;
            font-size: 0.9em;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 600px) {
            .container {
                margin: 10px;
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <h1>ğŸ¤– AI æ™ºèƒ½å¡«æŠ¥å¹´åº¦æ€»ç»“</h1>
        
        <!-- åŠŸèƒ½è¯´æ˜ -->
        <div class="description">
            <p>
                <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong>
                è¯·æä¾›æ‚¨çš„å·¥ä½œå†…å®¹ã€é¡¹ç›®è¿›å±•ã€ä¸ªäººæ€è€ƒç­‰ä¿¡æ¯ï¼ŒAIå°†æ™ºèƒ½åˆ†æå¹¶ä¸ºæ‚¨ç”Ÿæˆä¸“ä¸šçš„å¹´åº¦æ€»ç»“æŠ¥å‘Šã€‚
                æ”¯æŒç›´æ¥è¾“å…¥æ–‡æœ¬æˆ–ä¸Šä¼  .txt/.docx æ–‡ä»¶ã€‚
            </p>
        </div>
        
        <!-- ä¸»è¡¨å• -->
        <form id="summaryForm">
            <!-- æ–‡æœ¬è¾“å…¥åŒºåŸŸ -->
            <label for="textInput">ğŸ’¬ æ‰‹åŠ¨è¾“å…¥å†…å®¹ï¼š</label>
            <textarea 
                id="textInput" 
                name="text_input" 
                placeholder="ä¾‹å¦‚ï¼š
ä»Šå¹´æˆ‘ä¸»è¦è´Ÿè´£äº†Aé¡¹ç›®çš„å¼€å‘å·¥ä½œï¼ŒæˆåŠŸå®Œæˆäº†ç³»ç»Ÿæ¶æ„è®¾è®¡å’Œæ ¸å¿ƒåŠŸèƒ½å®ç°...
åœ¨Bé¡¹ç›®ä¸­é‡åˆ°äº†æŠ€æœ¯éš¾é¢˜ï¼Œé€šè¿‡æ·±å…¥ç ”ç©¶å’Œå›¢é˜Ÿåä½œï¼Œæœ€ç»ˆæ‰¾åˆ°äº†åˆ›æ–°çš„è§£å†³æ–¹æ¡ˆ...
å­¦ä¹ äº†æ–°çš„æŠ€æœ¯æ ˆï¼ŒåŒ…æ‹¬Pythonã€æœºå™¨å­¦ä¹ ç­‰ï¼Œå¹¶æˆåŠŸåº”ç”¨åˆ°å®é™…é¡¹ç›®ä¸­...
æ˜å¹´è®¡åˆ’ç»§ç»­æ·±åŒ–æŠ€æœ¯èƒ½åŠ›ï¼Œæ‰¿æ‹…æ›´å¤šæœ‰æŒ‘æˆ˜æ€§çš„é¡¹ç›®..."
            ></textarea>

            <!-- åˆ†éš”çº¿ -->
            <div class="divider">
                <span>æˆ–è€…</span>
            </div>

            <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
            <label for="fileInput">ğŸ“ ä¸Šä¼ æ–‡ä»¶ï¼ˆæ”¯æŒ .txt æˆ– .docx æ ¼å¼ï¼‰ï¼š</label>
            <input type="file" id="fileInput" name="file" accept=".txt,.docx">

            <!-- æäº¤æŒ‰é’® -->
            <button type="submit" id="submitBtn">ğŸš€ ç”Ÿæˆå¹´åº¦æ€»ç»“</button>
        </form>

        <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
        <div class="result-section">
            <!-- åŠ è½½æç¤º -->
            <div class="loading" id="loadingMessage">
                <strong>ğŸ”„ AI æ­£åœ¨åŠªåŠ›åˆ†æä¸­ï¼Œè¯·ç¨å€™...</strong>
                <br><small>é€šå¸¸éœ€è¦10-30ç§’ï¼Œè¯·è€å¿ƒç­‰å¾…</small>
            </div>
            
            <!-- é”™è¯¯ä¿¡æ¯ -->
            <div class="error" id="errorMessage"></div>
            
            <!-- ä¸‹è½½é“¾æ¥ -->
            <div class="download-link" id="downloadLink">
                <a href="#" id="downloadBtn">ğŸ“¥ ç‚¹å‡»ä¸‹è½½ç”Ÿæˆçš„å¹´åº¦æ€»ç»“</a>
            </div>
        </div>
    </div>

    <!-- JavaScriptä»£ç  -->
    <script>
        /**
         * é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œçš„åˆå§‹åŒ–ä»£ç 
         */
        document.addEventListener('DOMContentLoaded', function() {
            console.log('AIå¹´åº¦æ€»ç»“ç”Ÿæˆå™¨é¡µé¢å·²åŠ è½½');

            // è·å–é¡µé¢å…ƒç´ çš„å¼•ç”¨
            const form = document.getElementById('summaryForm');
            const textInput = document.getElementById('textInput');
            const fileInput = document.getElementById('fileInput');
            const submitBtn = document.getElementById('submitBtn');
            const loadingMessage = document.getElementById('loadingMessage');
            const errorMessage = document.getElementById('errorMessage');
            const downloadLink = document.getElementById('downloadLink');
            const downloadBtn = document.getElementById('downloadBtn');

            /**
             * é‡ç½®é¡µé¢çŠ¶æ€
             * éšè—æ‰€æœ‰æç¤ºä¿¡æ¯ï¼Œæ¸…ç©ºé”™è¯¯æ¶ˆæ¯
             */
            function resetPageState() {
                loadingMessage.style.display = 'none';
                errorMessage.style.display = 'none';
                downloadLink.style.display = 'none';
                errorMessage.textContent = '';
                downloadBtn.removeAttribute('download');
                downloadBtn.href = '#';
            }

            /**
             * æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
             * @param {string} message - é”™è¯¯æ¶ˆæ¯
             */
            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.style.display = 'block';
                loadingMessage.style.display = 'none';
                submitBtn.disabled = false;
                submitBtn.textContent = 'ğŸš€ ç”Ÿæˆå¹´åº¦æ€»ç»“';
            }

            /**
             * æ˜¾ç¤ºåŠ è½½çŠ¶æ€
             */
            function showLoading() {
                loadingMessage.style.display = 'block';
                submitBtn.disabled = true;
                submitBtn.textContent = 'â³ å¤„ç†ä¸­...';
            }

            /**
             * æ–‡ä»¶é€‰æ‹©å˜åŒ–æ—¶çš„å¤„ç†
             * å½“ç”¨æˆ·é€‰æ‹©æ–‡ä»¶æ—¶ï¼Œæ¸…ç©ºæ–‡æœ¬è¾“å…¥æ¡†
             */
            fileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    textInput.value = '';
                    console.log('å·²é€‰æ‹©æ–‡ä»¶:', this.files[0].name);
                }
            });

            /**
             * æ–‡æœ¬è¾“å…¥å˜åŒ–æ—¶çš„å¤„ç†
             * å½“ç”¨æˆ·åœ¨æ–‡æœ¬æ¡†è¾“å…¥æ—¶ï¼Œæ¸…ç©ºæ–‡ä»¶é€‰æ‹©
             */
            textInput.addEventListener('input', function() {
                if (this.value.trim()) {
                    fileInput.value = '';
                }
            });

            /**
             * è¡¨å•æäº¤å¤„ç†å‡½æ•°
             * è¿™æ˜¯æ•´ä¸ªå‰ç«¯çš„æ ¸å¿ƒé€»è¾‘
             */
            form.addEventListener('submit', async function(event) {
                // é˜»æ­¢è¡¨å•çš„é»˜è®¤æäº¤è¡Œä¸º
                event.preventDefault();

                console.log('å¼€å§‹å¤„ç†è¡¨å•æäº¤');

                // é‡ç½®é¡µé¢çŠ¶æ€
                resetPageState();

                // è·å–ç”¨æˆ·è¾“å…¥
                const textValue = textInput.value.trim();
                const selectedFile = fileInput.files[0];

                // éªŒè¯ç”¨æˆ·è¾“å…¥
                if (!textValue && !selectedFile) {
                    showError('è¯·è‡³å°‘è¾“å…¥ä¸€äº›å†…å®¹æˆ–ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ã€‚');
                    return;
                }

                // éªŒè¯æ–‡ä»¶ç±»å‹ï¼ˆå¦‚æœæœ‰æ–‡ä»¶ï¼‰
                if (selectedFile) {
                    const fileName = selectedFile.name.toLowerCase();
                    if (!fileName.endsWith('.txt') && !fileName.endsWith('.docx')) {
                        showError('ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼Œè¯·ä¸Šä¼  .txt æˆ– .docx æ–‡ä»¶ã€‚');
                        return;
                    }

                    // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶ä¸º10MBï¼‰
                    const maxSize = 10 * 1024 * 1024; // 10MB
                    if (selectedFile.size > maxSize) {
                        showError('æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼Œè¯·ä¸Šä¼ å°äº10MBçš„æ–‡ä»¶ã€‚');
                        return;
                    }
                }

                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                showLoading();

                // æ„é€ è¡¨å•æ•°æ®
                const formData = new FormData();
                if (selectedFile) {
                    formData.append('file', selectedFile);
                    console.log('å‡†å¤‡ä¸Šä¼ æ–‡ä»¶:', selectedFile.name, 'å¤§å°:', selectedFile.size, 'å­—èŠ‚');
                } else {
                    formData.append('text_input', textValue);
                    console.log('å‡†å¤‡å‘é€æ–‡æœ¬ï¼Œé•¿åº¦:', textValue.length, 'å­—ç¬¦');
                }

                try {
                    console.log('æ­£åœ¨å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨...');

                    // å‘é€POSTè¯·æ±‚åˆ°åç«¯API
                    const response = await fetch('/generate_summary', {
                        method: 'POST',
                        body: formData
                    });

                    console.log('æ”¶åˆ°æœåŠ¡å™¨å“åº”ï¼ŒçŠ¶æ€ç :', response.status);

                    if (response.ok) {
                        // è¯·æ±‚æˆåŠŸï¼Œå¤„ç†æ–‡ä»¶ä¸‹è½½
                        console.log('è¯·æ±‚æˆåŠŸï¼Œå‡†å¤‡ä¸‹è½½æ–‡ä»¶');

                        // è·å–å“åº”çš„äºŒè¿›åˆ¶æ•°æ®ï¼ˆWordæ–‡æ¡£ï¼‰
                        const blob = await response.blob();

                        // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ä¸‹è½½URL
                        const url = URL.createObjectURL(blob);
                        downloadBtn.href = url;

                        // å°è¯•ä»å“åº”å¤´è·å–æ–‡ä»¶å
                        const contentDisposition = response.headers.get('Content-Disposition');
                        let filename = 'ç”Ÿæˆçš„å¹´åº¦æ€»ç»“.docx'; // é»˜è®¤æ–‡ä»¶å

                        if (contentDisposition) {
                            // è§£æContent-Dispositionå¤´éƒ¨è·å–æ–‡ä»¶å
                            const filenameMatch = contentDisposition.match(/filename\*?=(?:UTF-8'')?([^;]+)/);
                            if (filenameMatch && filenameMatch[1]) {
                                filename = decodeURIComponent(filenameMatch[1].replace(/%20/g, ' '));
                                filename = filename.replace(/^"|"$/g, ''); // ç§»é™¤å¯èƒ½çš„å¼•å·
                            }
                        }

                        downloadBtn.download = filename;
                        downloadLink.style.display = 'block';

                        console.log('æ–‡ä»¶å‡†å¤‡å®Œæˆï¼Œæ–‡ä»¶å:', filename);

                        // éšè—åŠ è½½çŠ¶æ€ï¼Œæ¢å¤æŒ‰é’®
                        loadingMessage.style.display = 'none';
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'ğŸš€ ç”Ÿæˆå¹´åº¦æ€»ç»“';

                    } else {
                        // è¯·æ±‚å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                        console.log('è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç :', response.status);

                        try {
                            const errorData = await response.json();
                            showError(errorData.error || 'ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚');
                        } catch (e) {
                            showError('æœåŠ¡å™¨å“åº”æ ¼å¼é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚');
                        }
                    }

                } catch (error) {
                    // ç½‘ç»œé”™è¯¯æˆ–å…¶ä»–å¼‚å¸¸
                    console.error('è¯·æ±‚è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error);
                    showError('ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–è”ç³»ç®¡ç†å‘˜ã€‚');
                }
            });

            /**
             * ä¸‹è½½æŒ‰é’®ç‚¹å‡»å¤„ç†
             * åœ¨ç”¨æˆ·ç‚¹å‡»ä¸‹è½½åæ¸…ç†ä¸´æ—¶URL
             */
            downloadBtn.addEventListener('click', function() {
                // å»¶è¿Ÿæ¸…ç†URLï¼Œç¡®ä¿ä¸‹è½½èƒ½å¤Ÿå®Œæˆ
                setTimeout(() => {
                    if (this.href && this.href.startsWith('blob:')) {
                        URL.revokeObjectURL(this.href);
                        console.log('å·²æ¸…ç†ä¸´æ—¶ä¸‹è½½URL');
                    }
                }, 1000);
            });
        });
    </script>
</body>
</html>
